/**
 * Jquery excPuzzle
 *
 * @version 1.1 2014/03/12
 * @author r.mogi
 */
(function(t,e){$.fn.excPuzzle=function(t){var n=$(this),a=/Opera|MSIE/i.exec(e),t=$.extend({split:2,change:false,complate:false},t),s=function(t){var e=t.find("> *"),i=e.size();e.each(function(){e.eq(Math.floor(Math.random()*i)).prependTo(t)})},o=function(t){var e,a=n.find("div"),s=a.size();for(i=0;i<s;i++){e=a.filter("[data-number="+i+"]").css("transform");if(e!=t[i])return false}return true},r=function(){var t=0,e=n.find("div");$.each(e,function(e,i){if($(i).attr("data-number")==e){t+=1}});return Math.ceil(t/e.size()*100)},c=function(t,e){var i={};vendors=["","-webkit-","-moz-","-o-","-ms-"],$.each(vendors,function(n,a){i[a+t]=e});return i},f=function(){var e=0,f=0,u=0,d=n.data("split")||t.split,l=n.data("url")||t.url,h=n.find("img"),v=h.attr("src"),m=h.attr("width"),p=h.attr("height"),b=m/d,g=p/d,x=d*d;h.hide();n.css({height:p,position:"relative",width:m});for(i=0;i<x;i++){if(i%d==0){u=-g*e++;f=0}else{f=-b*(i%d)}n.append($("<div>").css({background:"url("+v+") no-repeat","background-size":m+"px "+p+"px","background-position":f+"px "+u+"px",border:"1px solid #000","float":"left",height:g,position:"absolute",width:b}).attr("data-number",i))}s(n);while(r()!=0){s(n)}var e=0,w,z=n.find("div"),C=0,k=0;z.each(function(t,i){if(t%d==0){k=g*e++;C=0}else{C=b*(t%d)}if(a){w=c("transform","translate("+C+"px, "+k+"px)")}else{w=c("transform","translate3d("+C+"px, "+k+"px, 0)")}$(i).css(w)});z.css(c("transition","all 500ms ease")).css(c("box-sizing","content-box"));var M=[];z.each(function(t,e){M.push($(e).css("transform"))});var y="mousedown",T="mousemove",j="mouseup";if("ontouchstart"in window){y="touchstart";T="touchmove";j="touchend"}n.find("div").bind(y,function(){this.touched=true}).bind(T,function(){this.touched=false}).bind(j,function(){if(!this.touched)return;var e=$(this);if(z.hasClass("active")){if(e.hasClass("active")){e.removeClass("active")}else{var i=n.find(".active"),a=i.css("transform"),s=e.css("transform"),r=i.attr("data-number"),f=e.attr("data-number");i.css(c("transform",s)).removeClass("active");e.css(c("transform",a));if(typeof t.change=="function"){t.change()}setTimeout(function(){if(o(M)){z.unbind().css("border-color","transparent");if(typeof t.complate=="function"){t.complate()}}},700)}}else{e.addClass("active")}})};f()}})(jQuery,navigator.userAgent);
